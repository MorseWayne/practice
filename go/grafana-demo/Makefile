.PHONY: help up down restart logs build run test clean

help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "å¯ç”¨å‘½ä»¤ï¼š"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

up: ## å¯åŠ¨æ‰€æœ‰æœåŠ¡
	docker-compose up -d
	@echo "âœ… æœåŠ¡å·²å¯åŠ¨"
	@echo "ğŸ“± Go åº”ç”¨: http://localhost:8080"
	@echo "ğŸ“Š Prometheus: http://localhost:9090"
	@echo "ğŸ“ˆ Grafana: http://localhost:3000 (admin/admin)"

down: ## åœæ­¢æ‰€æœ‰æœåŠ¡
	docker-compose down
	@echo "âœ… æœåŠ¡å·²åœæ­¢"

restart: down up ## é‡å¯æ‰€æœ‰æœåŠ¡

logs: ## æŸ¥çœ‹æœåŠ¡æ—¥å¿—
	docker-compose logs -f

build: ## æ„å»º Go åº”ç”¨
	go build -o bin/grafana-demo main.go
	@echo "âœ… æ„å»ºå®Œæˆ: bin/grafana-demo"

run: ## æœ¬åœ°è¿è¡Œ Go åº”ç”¨
	go run main.go

test: ## è¿è¡Œæµ‹è¯•
	go test -v ./...

clean: ## æ¸…ç†å®¹å™¨å’Œæ•°æ®å·
	docker-compose down -v
	rm -rf bin/
	@echo "âœ… æ¸…ç†å®Œæˆ"

rebuild: ## é‡æ–°æ„å»ºå¹¶å¯åŠ¨
	docker-compose down
	docker-compose build --no-cache
	docker-compose up -d
	@echo "âœ… é‡æ–°æ„å»ºå¹¶å¯åŠ¨å®Œæˆ"

ps: ## æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
	docker-compose ps

deps: ## ä¸‹è½½ Go ä¾èµ–
	go mod download
	go mod tidy

fmt: ## æ ¼å¼åŒ–ä»£ç 
	go fmt ./...

vet: ## ä»£ç æ£€æŸ¥
	go vet ./...
